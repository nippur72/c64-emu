------- FILE terminal.asm LEVEL 1 PASS 2
      1  08a8		       d7 f2	   MODEM_DATA_OUT EQU	$D7F2
      2  08a8		       d7 f0	   MODEM_DATA_IN EQU	$D7F0
      3  08a8		       d7 f3	   MODEM_DATA_REQ EQU	$D7F3
      4  08a8		       d7 f1	   MODEM_ACK  EQU	$D7F1	; PORTA PER L'HANDSHAKE
      5  08a8		       d7 f4	   MODEM_CONNST EQU	$D7F4
      6  08a8 ????
      7  08a8 ????				      PROCESSOR	6502
      8  08a8 ????
      9  08a8 ????
     10  08a8 ????
     11  08a8 ????
     12  08a8 ????
     13  08a8 ????
     14  08a8 ????
     15  08a8 ????
     16  08a8 ????
     17  08a8 ????
     18  08a8 ????
     19  08a8 ????
     20  08a8 ????
     21  08a8 ????
     22  08a8 ????
     23  08a8 ????
     24  08a8 ????
     25  08a8 ????
     26  08a8 ????
     27  08a8 ????
     28  08a8 ????
     29  08a8 ????
     30  08a8 ????
     31  08a8 ????
     32  08a8 ????
     33  08a8 ????
     34  08a8 ????
     35  08a8 ????
     36  08a8 ????
     37  08a8 ????
     38  08a8 ????
     39  08a8 ????
     40  08a8 ????
     41  08a8 ????
     42  08a8 ????
     43  08a8 ????
     44  08a8 ????
     45  08a8 ????
     46  08a8 ????
     47  08a8 ????
     48  08a8 ????
     49  08a8 ????
     50  08a8 ????
     51  08a8 ????
     52  08a8 ????
     53  08a8 ????
     54  08a8 ????
     55  08a8 ????
     56  08a8 ????
     57  08a8 ????
     58  08a8 ????
     59  08a8 ????
     60  08a8 ????
     61  08a8 ????
     62  08a8 ????
     63  08a8 ????
     64  08a8 ????
     65  08a8 ????
     66  08a8 ????
     67  08a8 ????
     68  08a8 ????
     69  08a8 ????
     70  08a8 ????
     71  08a8 ????
     72  08a8 ????
     73  08a8 ????
     74  08a8 ????
     75  08a8 ????
     76  08a8 ????
     77  08a8 ????
     78  08a8 ????
     79  08a8 ????
     80  08a8 ????
     81  08a8 ????
     82  08a8 ????
     83  08a8 ????
     84  08a8 ????
     85  08a8 ????
     86  08a8 ????
     87  08a8 ????
     88  08a8 ????
     89  08a8 ????
     90  08a8 ????
     91  08a8 ????
     92  08a8 ????
     93  08a8 ????
     94  08a8 ????
     95  08a8 ????
     96  08a8 ????
     97  08a8 ????
     98  08a8 ????
     99  08a8 ????
    100  08a8 ????
    101  08a8 ????
    102  08a8 ????
    103  08a8 ????
    104  08a8 ????
    105  08a8 ????
    106  08a8 ????
    107  08a8 ????
    108  08a8 ????
    109  08a8 ????
    110  08a8 ????
    111  08a8 ????
    112  08a8 ????
    113  08a8 ????
    114  08a8 ????
    115  08a8 ????
    116  08a8 ????
    117  08a8 ????
    118  08a8 ????
    119  08a8 ????
    120  08a8 ????
    121  08a8 ????
    122  08a8 ????
    123  08a8 ????
    124  08a8 ????
    125  08a8 ????
    126  08a8 ????
    127  08a8 ????
    128  08a8 ????
    129  08a8 ????
    130  08a8 ????
    131  08a8 ????
    132  08a8 ????
    133  08a8 ????
    134  08a8 ????
    135  08a8 ????
    136  08a8 ????
    137  08a8 ????
    138  08a8 ????
    139  08a8 ????
    140  08a8 ????
    141  08a8 ????
    142  08a8 ????
    143  08a8 ????
    144  08a8 ????
    145  08a8 ????
    146  08a8 ????
    147  08a8 ????
    148  08a8 ????
    149  08a8 ????
    150  08a8 ????
    151  08a8 ????
    152  08a8 ????
    153  08a8 ????
    154  08a8 ????
    155  08a8 ????
    156  08a8 ????
    157  08a8 ????
    158  08a8 ????
    159  08a8 ????
    160  08a8 ????
    161  08a8 ????
    162  08a8 ????
    163  08a8 ????
    164  08a8 ????
    165  08a8 ????
    166  08a8 ????
    167  08a8 ????
    168  08a8 ????
    169  08a8 ????
    170  08a8 ????
    171  08a8 ????
    172  08a8 ????
    173  08a8 ????
    174  08a8 ????
    175  08a8 ????
    176  08a8 ????
    177  08a8 ????
    178  08a8 ????
    179  08a8 ????
    180  08a8 ????
    181  08a8 ????
    182  08a8 ????
    183  08a8 ????
    184  08a8 ????
    185  08a8 ????
    186  08a8 ????
    187  08a8 ????
    188  08a8 ????
    189  08a8 ????
    190  08a8 ????
    191  08a8 ????
    192  08a8 ????
    193  08a8 ????
    194  08a8 ????
    195  08a8 ????
    196  08a8 ????
    197  08a8 ????
    198  08a8 ????
    199  08a8 ????
    200  08a8 ????
    201  08a8 ????
    202  08a8 ????
    203  08a8 ????
    204  08a8 ????
    205  08a8 ????
    206  08a8 ????
    207  08a8 ????
    208  08a8 ????
    209  08a8 ????
    210  08a8 ????
    211  08a8 ????
    212  08a8 ????
    213  08a8 ????
    214  08a8 ????
    215  08a8 ????
    216  08a8 ????
    217  08a8 ????
    218  08a8 ????
    219  08a8 ????
    220  08a8 ????
    221  08a8 ????
    222  08a8 ????
    223  08a8 ????
    224  08a8 ????
    225  08a8 ????
    226  08a8 ????
    227  08a8 ????
    228  08a8 ????
    229  08a8 ????
    230  08a8 ????
    231  08a8 ????
    232  08a8 ????
    233  08a8 ????
    234  08a8 ????
    235  08a8 ????
    236  08a8 ????
    237  08a8 ????
    238  08a8 ????
    239  08a8 ????
    240  08a8 ????
    241  08a8 ????
    242  08a8 ????
    243  08a8 ????
    244  08a8 ????
    245  08a8 ????
    246  08a8 ????
    247  08a8 ????
    248  08a8 ????
    249  08a8 ????
    250  08a8 ????
    251  08a8 ????
    252  08a8 ????
    253  08a8 ????
    254  08a8 ????
    255  08a8 ????
    256  08a8 ????
    257  08a8 ????
    258  08a8 ????
    259  08a8 ????
    260  08a8 ????
    261  08a8 ????
    262  08a8 ????
    263  08a8 ????
    264  08a8 ????
    265  08a8 ????
    266  08a8 ????
    267  08a8 ????
    268  08a8 ????
    269  08a8 ????
    270  08a8 ????
    271  08a8 ????
    272  08a8 ????
    273  08a8 ????
    274  08a8 ????
    275  08a8 ????
    276  08a8 ????
    277  08a8 ????
    278  08a8 ????
    279  08a8 ????
    280  08a8 ????
    281  08a8 ????
    282  08a8 ????
    283  08a8 ????
    284  08a8 ????
    285  08a8 ????
    286  08a8 ????
    287  08a8 ????
    288  08a8 ????
    289  08a8 ????
    290  08a8 ????
    291  08a8 ????
    292  08a8 ????
    293  08a8 ????
    294  08a8 ????
    295  08a8 ????
    296  08a8 ????
    297  08a8 ????
    298  08a8 ????
    299  08a8 ????
    300  08a8 ????
    301  08a8 ????
    302  08a8 ????
    303  08a8 ????
    304  08a8 ????
    305  08a8 ????
    306  08a8 ????
    307  08a8 ????
    308  08a8 ????
    309  08a8 ????
    310  08a8 ????
    311  08a8 ????
    312  08a8 ????
    313  08a8 ????
    314  08a8 ????
    315  08a8 ????
    316  08a8 ????
    317  08a8 ????
    318  08a8 ????
    319  08a8 ????
    320  08a8 ????
    321  08a8 ????
    322  08a8 ????
    323  08a8 ????
    324  08a8 ????
    325  08a8 ????
    326  08a8 ????
    327  08a8 ????
    328  08a8 ????
    329  08a8 ????
    330  08a8 ????
    331  08a8 ????
    332  08a8 ????
    333  08a8 ????
    334  08a8 ????
    335  08a8 ????
    336  08a8 ????
    337  08a8 ????
    338  08a8 ????
    339  08a8 ????
    340  08a8 ????
    341  08a8 ????
    342  08a8 ????
    343  08a8 ????
    344  08a8 ????
    345  08a8 ????
    346  08a8 ????
    347  08a8 ????
    348  08a8 ????
    349  08a8 ????
    350  08a8 ????
    351  08a8 ????
    352  08a8 ????
    353  08a8 ????
    354  08a8 ????
    355  08a8 ????
    356  08a8 ????
    357  08a8 ????
    358  08a8 ????
    359  08a8 ????
    360  08a8 ????
    361  08a8 ????
    362  08a8 ????
    363  08a8 ????
    364  08a8 ????
    365  08a8 ????
    366  08a8 ????
    367  08a8 ????
    368  08a8 ????
    369  08a8 ????
    370  08a8 ????
    371  08a8 ????
    372  08a8 ????
    373  08a8 ????
    374  08a8 ????
    375  08a8 ????
    376  08a8 ????
    377  08a8 ????
    378  08a8 ????
    379  08a8 ????
    380  08a8 ????
    381  08a8 ????
    382  08a8 ????
    383  08a8 ????
    384  08a8 ????
    385  08a8 ????
    386  08a8 ????
    387  08a8 ????
    388  08a8 ????
    389  08a8 ????
    390  08a8 ????
    391  08a8 ????
    392  08a8 ????
    393  08a8 ????
    394  08a8 ????
    395  08a8 ????
    396  08a8 ????
    397  08a8 ????
    398  08a8 ????
    399  08a8 ????
    400  08a8 ????
    401  08a8 ????
    402  08a8 ????
    403  08a8 ????
    404  08a8 ????
    405  08a8 ????
    406  08a8 ????
    407  08a8 ????
    408  08a8 ????
    409  08a8 ????
    410  08a8 ????
    411  08a8 ????
    412  08a8 ????
    413  08a8 ????
    414  08a8 ????
    415  08a8 ????
    416  08a8 ????
    417  08a8 ????
    418  08a8 ????
    419  08a8 ????
    420  08a8 ????
    421  08a8 ????
    422  08a8 ????
    423  08a8 ????
    424  08a8 ????
    425  08a8 ????
    426  08a8 ????
    427  08a8 ????
    428  08a8 ????
    429  08a8 ????
    430  08a8 ????
    431  08a8 ????
    432  08a8 ????
    433  08a8 ????
    434  08a8 ????
    435  08a8 ????
    436  08a8 ????
    437  08a8 ????
    438  08a8 ????
    439  08a8 ????
    440  08a8 ????
    441  08a8 ????
    442  08a8 ????
    443  08a8 ????
    444  08a8 ????
    445  08a8 ????
    446  08a8 ????
    447  08a8 ????
    448  08a8 ????
    449  08a8 ????
    450  08a8 ????
    451  08a8 ????
    452  08a8 ????
    453  08a8 ????
    454  08a8 ????
    455  08a8 ????
    456  08a8 ????
    457  08a8 ????
    458  08a8 ????
    459  08a8 ????
    460  08a8 ????
    461  08a8 ????
    462  08a8 ????	       ff e4	   GETIN      =	$FFE4
    463  08a8 ????	       e5 44	   CLRSCN     =	$E544
    464  08a8 ????	       ab 1e	   PRNSTR     =	$AB1E
    465  08a8 ????	       e5 66	   GOHOME     =	$E566
    466  08a8 ????	       bd cd	   PRNINT     =	$BDCD
    467  08a8 ????
    468  08a8 ????
    469  08a8 ????
    470  08a8 ????	       00 d1	   CURSOR_PTR =	209
    471  08a8 ????	       00 a2	   JIFFY_CLOCK =	162
    472  08a8 ????	       02 86	   CRSRCOL    =	646
    473  08a8 ????	       00 01	   MEMORY_CONFIG =	1
    474  08a8 ????
    475  08a8 ????
    476  08a8 ????
    477  08a8 ????	       00 00	   COLOR_BLACK =	0
    478  08a8 ????	       00 01	   COLOR_WHITE =	1
    479  08a8 ????	       00 02	   COLOR_RED  =	2
    480  08a8 ????	       00 03	   COLOR_CYAN =	3
    481  08a8 ????	       00 04	   COLOR_MAGENTA =	4
    482  08a8 ????	       00 05	   COLOR_GREEN =	5
    483  08a8 ????	       00 06	   COLOR_BLUE =	6
    484  08a8 ????	       00 07	   COLOR_YELLOW =	7
    485  08a8 ????
    486  08a8 ????
    487  08a8 ????
    488  08a8 ????
    489  08a8 ????	       00 28	   SCREEN_COLS =	40
    490  08a8 ????	       00 19	   SCREEN_ROWS =	25
    491  08a8 ????	       04 00	   VIDEO_RAM  =	1024
    492  08a8 ????	       d8 00	   COLOR_RAM  =	55296
    493  08a8 ????	       00 d4	   COLOR_PAGE_OFFSET =	((COLOR_RAM - VIDEO_RAM) / 256)
    494  08a8 ????	       08 01	   BASIC_RAM  =	2049
    495  08a8 ????	       d0 12	   RASTER     =	$D012
    496  08a8 ????	       d0 00	   ROMCHAR    =	$D000
    497  08a8 ????	       d0 20	   BORDER     =	53280
    498  08a8 ????	       d0 21	   BACKGROUND =	53281
    499  08a8 ????
    500  08a8 ????
    501  08a8 ????
    502  08a8 ????
    503  08a8 ????
    504  08a8 ????
    505  08a8 ????
    506  08a8 ????
    507  08a8 ????
    508  08a8 ????
    509  08a8 ????
    510  08a8 ????
    511  08a8 ????
    512  08a8 ????
    513  08a8 ????
    514  08a8 ????
    515  08a8 ????
    516  08a8 ????
    517  08a8 ????
    518  08a8 ????
    519  08a8 ????
    520  08a8 ????
    521  08a8 ????
    522  08a8 ????
    523  08a8 ????
    524  08a8 ????
    525  08a8 ????
    526  08a8 ????
    527  08a8 ????
    528  08a8 ????
    529  08a8 ????
    530  08a8 ????
    531  08a8 ????
    532  08a8 ????
    533  08a8 ????
    534  08a8 ????
    535  08a8 ????
    536  08a8 ????
    537  08a8 ????
    538  08a8 ????
    539  08a8 ????
    540  08a8 ????
    541  08a8 ????
    542  08a8 ????
    543  08a8 ????
    544  08a8 ????
    545  08a8 ????
    546  08a8 ????
    547  08a8 ????
    548  08a8 ????
    549  08a8 ????
    550  08a8 ????
    551  08a8 ????
    552  08a8 ????
    553  08a8 ????
    554  08a8 ????
    555  08a8 ????
    556  08a8 ????
    557  08a8 ????
    558  08a8 ????
    559  08a8 ????
    560  08a8 ????
    561  08a8 ????
    562  08a8 ????	       ff e4	   GETIN      =	$FFE4
    563  08a8 ????	       ff d2	   CHROUT     =	$FFD2
    564  08a8 ????
    565  0801					      ORG	BASIC_RAM
    566  0801
    567  0801
    568  0801
    569  0801
    570  0801
    571  0801
    572  0801
    573  0801
    574  0801
    575  0801		       0c 08 e4 07*BASIC_ROW_0 BYTE.b	[BASIC_ROW_1%256],[BASIC_ROW_1/256],[2020%256],[2020/256],158,[[[MAIN%100000]-[MAIN%10000]]/10000+$30],[[[MAIN%10000]-[MAIN%1000]]/1000+$30],[[[MAIN%1000]-[MAIN%100]]/100+$30],[[[MAIN%100]-[MAIN%10]]/10+$30],[[[MAIN%10]-[MAIN%1]]/1+$30],0
    576  080c		       00 00	   BASIC_ROW_1 BYTE.b	0,0
    577  080e
    578  080e				   MAIN
    579  080e		       a9 00		      LDA	#0
    580  0810		       8d 20 d0 	      STA	53280
    581  0813
    582  0813		       a9 00		      LDA	#0
    583  0815		       8d 21 d0 	      STA	53281
    584  0818
    585  0818		       a9 0f		      LDA	#15
    586  081a		       8d 18 d4 	      STA	54296
    587  081d
    588  081d		       a9 0e		      LDA	#14
    589  081f		       20 d2 ff 	      JSR	CHROUT
    590  0822		       a9 93		      LDA	#147
    591  0824		       20 d2 ff 	      JSR	CHROUT
    592  0827		       a9 05		      LDA	#5
    593  0829		       20 d2 ff 	      JSR	CHROUT
    594  082c
    595  082c				   TERMINAL
    596  082c
    597  082c		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    598  082f				   IF_591_START
    599  082f		       c9 00		      CMP	#0
    600  0831		       f0 2a		      BEQ	IF_591_ELSE
    601  0833		       20 78 08 	      JSR	CURSOR_OFF
    602  0836				   DO_593_START
    603  0836
    604  0836		       a2 00		      LDX	#0
    605  0838		       86 d4		      STX	$D4
    606  083a		       86 d8		      STX	$D8
    607  083c
    608  083c
    609  083c		       ad f0 d7 	      LDA	MODEM_DATA_IN
    610  083f
    611  083f
    612  083f		       48		      PHA
    613  0840				   IF_604_START
    614  0840		       c9 07		      CMP	#7
    615  0842		       d0 03		      BNE	IF_604_ELSE
    616  0844		       20 89 08 	      JSR	TERM_BELL
    617  0847				   IF_604_ELSE
    618  0847				   IF_604_END
    619  0847
    620  0847		       68		      PLA
    621  0848
    622  0848
    623  0848		       20 d2 ff 	      JSR	CHROUT
    624  084b
    625  084b
    626  084b		       a9 00		      LDA	#0
    627  084d		       8d f1 d7 	      STA	MODEM_ACK
    628  0850		       a9 01		      LDA	#1
    629  0852		       8d f1 d7 	      STA	MODEM_ACK
    630  0855
    631  0855
    632  0855		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    633  0858		       d0 dc		      BNE	DO_593_START
    634  085a				   DO_593_END
    635  085a
    636  085a		       20 73 08 	      JSR	CURSOR_ON
    637  085d				   IF_591_ELSE
    638  085d				   IF_591_END
    639  085d
    640  085d
    641  085d		       20 e4 ff 	      JSR	GETIN
    642  0860				   IF_629_START
    643  0860		       c9 00		      CMP	#0
    644  0862		       f0 03		      BEQ	IF_629_ELSE
    645  0864		       8d f2 d7 	      STA	MODEM_DATA_OUT
    646  0867				   IF_629_ELSE
    647  0867				   IF_629_END
    648  0867
    649  0867
    650  0867
    651  0867		       ad f4 d7 	      LDA	MODEM_CONNST
    652  086a		       8d 20 d0 	      STA	53280
    653  086d		       8d 21 d0 	      STA	53281
    654  0870
    655  0870		       4c 2c 08 	      JMP	TERMINAL
    656  0873
    657  0873
    658  0873
    659  0873
    660  0873				   CURSOR_ON
    661  0873		       a0 00		      LDY	#$00
    662  0875		       84 cc		      STY	$CC
    663  0877		       60		      RTS
    664  0878
    665  0878				   CURSOR_OFF
    666  0878		       a4 cc		      LDY	$CC
    667  087a				   IF_651_START
    668  087a		       d0 08		      BNE	IF_651_ELSE
    669  087c		       a0 01		      LDY	#$01
    670  087e		       84 cd		      STY	$CD
    671  0880				   DO_646_START
    672  0880		       a4 cf		      LDY	$CF
    673  0882		       d0 fc		      BNE	DO_646_START
    674  0884				   DO_646_END
    675  0884
    676  0884				   IF_651_ELSE
    677  0884				   IF_651_END
    678  0884		       a0 ff		      LDY	#$FF
    679  0886		       84 cc		      STY	$CC
    680  0888		       60		      RTS
    681  0889
    682  0889				   TERM_BELL
    683  0889		       a9 0f		      LDA	#15
    684  088b		       8d 18 d4 	      STA	$D418
    685  088e
    686  088e		       a9 14		      LDA	#20
    687  0890		       8d 01 d4 	      STA	$D401
    688  0893
    689  0893		       a9 00		      LDA	#0
    690  0895		       8d 05 d4 	      STA	$D405
    691  0898
    692  0898		       a9 f9		      LDA	#249
    693  089a		       8d 06 d4 	      STA	$D406
    694  089d
    695  089d		       a9 11		      LDA	#17
    696  089f		       8d 04 d4 	      STA	$D404
    697  08a2
    698  08a2		       a9 10		      LDA	#16
    699  08a4		       8d 04 d4 	      STA	$D404
    700  08a7
    701  08a7		       60		      RTS
    702  08a8
