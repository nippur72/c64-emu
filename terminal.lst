------- FILE terminal.asm LEVEL 1 PASS 2
      1  08a9		       d7 f2	   MODEM_DATA_OUT EQU	$D7F2
      2  08a9		       d7 f0	   MODEM_DATA_IN EQU	$D7F0
      3  08a9		       d7 f3	   MODEM_DATA_REQ EQU	$D7F3
      4  08a9		       d7 f1	   MODEM_ACK  EQU	$D7F1	; PORTA PER L'HANDSHAKE
      5  08a9		       d7 f4	   MODEM_CONNST EQU	$D7F4
      6  08a9 ????
      7  08a9 ????				      PROCESSOR	6502
      8  08a9 ????
      9  08a9 ????
     10  08a9 ????
     11  08a9 ????
     12  08a9 ????
     13  08a9 ????
     14  08a9 ????
     15  08a9 ????
     16  08a9 ????
     17  08a9 ????
     18  08a9 ????
     19  08a9 ????
     20  08a9 ????
     21  08a9 ????
     22  08a9 ????
     23  08a9 ????
     24  08a9 ????
     25  08a9 ????
     26  08a9 ????
     27  08a9 ????
     28  08a9 ????
     29  08a9 ????
     30  08a9 ????
     31  08a9 ????
     32  08a9 ????
     33  08a9 ????
     34  08a9 ????
     35  08a9 ????
     36  08a9 ????
     37  08a9 ????
     38  08a9 ????
     39  08a9 ????
     40  08a9 ????
     41  08a9 ????
     42  08a9 ????
     43  08a9 ????
     44  08a9 ????
     45  08a9 ????
     46  08a9 ????
     47  08a9 ????
     48  08a9 ????
     49  08a9 ????
     50  08a9 ????
     51  08a9 ????
     52  08a9 ????
     53  08a9 ????
     54  08a9 ????
     55  08a9 ????
     56  08a9 ????
     57  08a9 ????
     58  08a9 ????
     59  08a9 ????
     60  08a9 ????
     61  08a9 ????
     62  08a9 ????
     63  08a9 ????
     64  08a9 ????
     65  08a9 ????
     66  08a9 ????
     67  08a9 ????
     68  08a9 ????
     69  08a9 ????
     70  08a9 ????
     71  08a9 ????
     72  08a9 ????
     73  08a9 ????
     74  08a9 ????
     75  08a9 ????
     76  08a9 ????
     77  08a9 ????
     78  08a9 ????
     79  08a9 ????
     80  08a9 ????
     81  08a9 ????
     82  08a9 ????
     83  08a9 ????
     84  08a9 ????
     85  08a9 ????
     86  08a9 ????
     87  08a9 ????
     88  08a9 ????
     89  08a9 ????
     90  08a9 ????
     91  08a9 ????
     92  08a9 ????
     93  08a9 ????
     94  08a9 ????
     95  08a9 ????
     96  08a9 ????
     97  08a9 ????
     98  08a9 ????
     99  08a9 ????
    100  08a9 ????
    101  08a9 ????
    102  08a9 ????
    103  08a9 ????
    104  08a9 ????
    105  08a9 ????
    106  08a9 ????
    107  08a9 ????
    108  08a9 ????
    109  08a9 ????
    110  08a9 ????
    111  08a9 ????
    112  08a9 ????
    113  08a9 ????
    114  08a9 ????
    115  08a9 ????
    116  08a9 ????
    117  08a9 ????
    118  08a9 ????
    119  08a9 ????
    120  08a9 ????
    121  08a9 ????
    122  08a9 ????
    123  08a9 ????
    124  08a9 ????
    125  08a9 ????
    126  08a9 ????
    127  08a9 ????
    128  08a9 ????
    129  08a9 ????
    130  08a9 ????
    131  08a9 ????
    132  08a9 ????
    133  08a9 ????
    134  08a9 ????
    135  08a9 ????
    136  08a9 ????
    137  08a9 ????
    138  08a9 ????
    139  08a9 ????
    140  08a9 ????
    141  08a9 ????
    142  08a9 ????
    143  08a9 ????
    144  08a9 ????
    145  08a9 ????
    146  08a9 ????
    147  08a9 ????
    148  08a9 ????
    149  08a9 ????
    150  08a9 ????
    151  08a9 ????
    152  08a9 ????
    153  08a9 ????
    154  08a9 ????
    155  08a9 ????
    156  08a9 ????
    157  08a9 ????
    158  08a9 ????
    159  08a9 ????
    160  08a9 ????
    161  08a9 ????
    162  08a9 ????
    163  08a9 ????
    164  08a9 ????
    165  08a9 ????
    166  08a9 ????
    167  08a9 ????
    168  08a9 ????
    169  08a9 ????
    170  08a9 ????
    171  08a9 ????
    172  08a9 ????
    173  08a9 ????
    174  08a9 ????
    175  08a9 ????
    176  08a9 ????
    177  08a9 ????
    178  08a9 ????
    179  08a9 ????
    180  08a9 ????
    181  08a9 ????
    182  08a9 ????
    183  08a9 ????
    184  08a9 ????
    185  08a9 ????
    186  08a9 ????
    187  08a9 ????
    188  08a9 ????
    189  08a9 ????
    190  08a9 ????
    191  08a9 ????
    192  08a9 ????
    193  08a9 ????
    194  08a9 ????
    195  08a9 ????
    196  08a9 ????
    197  08a9 ????
    198  08a9 ????
    199  08a9 ????
    200  08a9 ????
    201  08a9 ????
    202  08a9 ????
    203  08a9 ????
    204  08a9 ????
    205  08a9 ????
    206  08a9 ????
    207  08a9 ????
    208  08a9 ????
    209  08a9 ????
    210  08a9 ????
    211  08a9 ????
    212  08a9 ????
    213  08a9 ????
    214  08a9 ????
    215  08a9 ????
    216  08a9 ????
    217  08a9 ????
    218  08a9 ????
    219  08a9 ????
    220  08a9 ????
    221  08a9 ????
    222  08a9 ????
    223  08a9 ????
    224  08a9 ????
    225  08a9 ????
    226  08a9 ????
    227  08a9 ????
    228  08a9 ????
    229  08a9 ????
    230  08a9 ????
    231  08a9 ????
    232  08a9 ????
    233  08a9 ????
    234  08a9 ????
    235  08a9 ????
    236  08a9 ????
    237  08a9 ????
    238  08a9 ????
    239  08a9 ????
    240  08a9 ????
    241  08a9 ????
    242  08a9 ????
    243  08a9 ????
    244  08a9 ????
    245  08a9 ????
    246  08a9 ????
    247  08a9 ????
    248  08a9 ????
    249  08a9 ????
    250  08a9 ????
    251  08a9 ????
    252  08a9 ????
    253  08a9 ????
    254  08a9 ????
    255  08a9 ????
    256  08a9 ????
    257  08a9 ????
    258  08a9 ????
    259  08a9 ????
    260  08a9 ????
    261  08a9 ????
    262  08a9 ????
    263  08a9 ????
    264  08a9 ????
    265  08a9 ????
    266  08a9 ????
    267  08a9 ????
    268  08a9 ????
    269  08a9 ????
    270  08a9 ????
    271  08a9 ????
    272  08a9 ????
    273  08a9 ????
    274  08a9 ????
    275  08a9 ????
    276  08a9 ????
    277  08a9 ????
    278  08a9 ????
    279  08a9 ????
    280  08a9 ????
    281  08a9 ????
    282  08a9 ????
    283  08a9 ????
    284  08a9 ????
    285  08a9 ????
    286  08a9 ????
    287  08a9 ????
    288  08a9 ????
    289  08a9 ????
    290  08a9 ????
    291  08a9 ????
    292  08a9 ????
    293  08a9 ????
    294  08a9 ????
    295  08a9 ????
    296  08a9 ????
    297  08a9 ????
    298  08a9 ????
    299  08a9 ????
    300  08a9 ????
    301  08a9 ????
    302  08a9 ????
    303  08a9 ????
    304  08a9 ????
    305  08a9 ????
    306  08a9 ????
    307  08a9 ????
    308  08a9 ????
    309  08a9 ????
    310  08a9 ????
    311  08a9 ????
    312  08a9 ????
    313  08a9 ????
    314  08a9 ????
    315  08a9 ????
    316  08a9 ????
    317  08a9 ????
    318  08a9 ????
    319  08a9 ????
    320  08a9 ????
    321  08a9 ????
    322  08a9 ????
    323  08a9 ????
    324  08a9 ????
    325  08a9 ????
    326  08a9 ????
    327  08a9 ????
    328  08a9 ????
    329  08a9 ????
    330  08a9 ????
    331  08a9 ????
    332  08a9 ????
    333  08a9 ????
    334  08a9 ????
    335  08a9 ????
    336  08a9 ????
    337  08a9 ????
    338  08a9 ????
    339  08a9 ????
    340  08a9 ????
    341  08a9 ????
    342  08a9 ????
    343  08a9 ????
    344  08a9 ????
    345  08a9 ????
    346  08a9 ????
    347  08a9 ????
    348  08a9 ????
    349  08a9 ????
    350  08a9 ????
    351  08a9 ????
    352  08a9 ????
    353  08a9 ????
    354  08a9 ????
    355  08a9 ????
    356  08a9 ????
    357  08a9 ????
    358  08a9 ????
    359  08a9 ????
    360  08a9 ????
    361  08a9 ????
    362  08a9 ????
    363  08a9 ????
    364  08a9 ????
    365  08a9 ????
    366  08a9 ????
    367  08a9 ????
    368  08a9 ????
    369  08a9 ????
    370  08a9 ????
    371  08a9 ????
    372  08a9 ????
    373  08a9 ????
    374  08a9 ????
    375  08a9 ????
    376  08a9 ????
    377  08a9 ????
    378  08a9 ????
    379  08a9 ????
    380  08a9 ????
    381  08a9 ????
    382  08a9 ????
    383  08a9 ????
    384  08a9 ????
    385  08a9 ????
    386  08a9 ????
    387  08a9 ????
    388  08a9 ????
    389  08a9 ????
    390  08a9 ????
    391  08a9 ????
    392  08a9 ????
    393  08a9 ????
    394  08a9 ????
    395  08a9 ????
    396  08a9 ????
    397  08a9 ????
    398  08a9 ????
    399  08a9 ????
    400  08a9 ????
    401  08a9 ????
    402  08a9 ????
    403  08a9 ????
    404  08a9 ????
    405  08a9 ????
    406  08a9 ????
    407  08a9 ????
    408  08a9 ????
    409  08a9 ????
    410  08a9 ????
    411  08a9 ????
    412  08a9 ????
    413  08a9 ????
    414  08a9 ????
    415  08a9 ????
    416  08a9 ????
    417  08a9 ????
    418  08a9 ????
    419  08a9 ????
    420  08a9 ????
    421  08a9 ????
    422  08a9 ????
    423  08a9 ????
    424  08a9 ????
    425  08a9 ????
    426  08a9 ????
    427  08a9 ????
    428  08a9 ????
    429  08a9 ????
    430  08a9 ????
    431  08a9 ????
    432  08a9 ????
    433  08a9 ????
    434  08a9 ????
    435  08a9 ????
    436  08a9 ????
    437  08a9 ????
    438  08a9 ????
    439  08a9 ????
    440  08a9 ????
    441  08a9 ????
    442  08a9 ????
    443  08a9 ????
    444  08a9 ????
    445  08a9 ????
    446  08a9 ????
    447  08a9 ????
    448  08a9 ????
    449  08a9 ????
    450  08a9 ????
    451  08a9 ????
    452  08a9 ????
    453  08a9 ????
    454  08a9 ????
    455  08a9 ????
    456  08a9 ????
    457  08a9 ????
    458  08a9 ????
    459  08a9 ????
    460  08a9 ????
    461  08a9 ????
    462  08a9 ????	       ff e4	   GETIN      =	$FFE4
    463  08a9 ????	       e5 44	   CLRSCN     =	$E544
    464  08a9 ????	       ab 1e	   PRNSTR     =	$AB1E
    465  08a9 ????	       e5 66	   GOHOME     =	$E566
    466  08a9 ????	       bd cd	   PRNINT     =	$BDCD
    467  08a9 ????
    468  08a9 ????
    469  08a9 ????
    470  08a9 ????	       00 d1	   CURSOR_PTR =	209
    471  08a9 ????	       00 a2	   JIFFY_CLOCK =	162
    472  08a9 ????	       02 86	   CRSRCOL    =	646
    473  08a9 ????	       00 01	   MEMORY_CONFIG =	1
    474  08a9 ????
    475  08a9 ????
    476  08a9 ????
    477  08a9 ????	       00 00	   COLOR_BLACK =	0
    478  08a9 ????	       00 01	   COLOR_WHITE =	1
    479  08a9 ????	       00 02	   COLOR_RED  =	2
    480  08a9 ????	       00 03	   COLOR_CYAN =	3
    481  08a9 ????	       00 04	   COLOR_MAGENTA =	4
    482  08a9 ????	       00 05	   COLOR_GREEN =	5
    483  08a9 ????	       00 06	   COLOR_BLUE =	6
    484  08a9 ????	       00 07	   COLOR_YELLOW =	7
    485  08a9 ????
    486  08a9 ????
    487  08a9 ????
    488  08a9 ????
    489  08a9 ????	       00 28	   SCREEN_COLS =	40
    490  08a9 ????	       00 19	   SCREEN_ROWS =	25
    491  08a9 ????	       04 00	   VIDEO_RAM  =	1024
    492  08a9 ????	       d8 00	   COLOR_RAM  =	55296
    493  08a9 ????	       00 d4	   COLOR_PAGE_OFFSET =	((COLOR_RAM - VIDEO_RAM) / 256)
    494  08a9 ????	       08 01	   BASIC_RAM  =	2049
    495  08a9 ????	       d0 12	   RASTER     =	$D012
    496  08a9 ????	       d0 00	   ROMCHAR    =	$D000
    497  08a9 ????	       d0 20	   BORDER     =	53280
    498  08a9 ????	       d0 21	   BACKGROUND =	53281
    499  08a9 ????
    500  08a9 ????
    501  08a9 ????
    502  08a9 ????
    503  08a9 ????
    504  08a9 ????
    505  08a9 ????
    506  08a9 ????
    507  08a9 ????
    508  08a9 ????
    509  08a9 ????
    510  08a9 ????
    511  08a9 ????
    512  08a9 ????
    513  08a9 ????
    514  08a9 ????
    515  08a9 ????
    516  08a9 ????
    517  08a9 ????
    518  08a9 ????
    519  08a9 ????
    520  08a9 ????
    521  08a9 ????
    522  08a9 ????
    523  08a9 ????
    524  08a9 ????
    525  08a9 ????
    526  08a9 ????
    527  08a9 ????
    528  08a9 ????
    529  08a9 ????
    530  08a9 ????
    531  08a9 ????
    532  08a9 ????
    533  08a9 ????
    534  08a9 ????
    535  08a9 ????
    536  08a9 ????
    537  08a9 ????
    538  08a9 ????
    539  08a9 ????
    540  08a9 ????
    541  08a9 ????
    542  08a9 ????
    543  08a9 ????
    544  08a9 ????
    545  08a9 ????
    546  08a9 ????
    547  08a9 ????
    548  08a9 ????
    549  08a9 ????
    550  08a9 ????
    551  08a9 ????
    552  08a9 ????
    553  08a9 ????
    554  08a9 ????
    555  08a9 ????
    556  08a9 ????
    557  08a9 ????
    558  08a9 ????
    559  08a9 ????
    560  08a9 ????
    561  08a9 ????
    562  08a9 ????	       ff e4	   GETIN      =	$FFE4
    563  08a9 ????	       ff d2	   CHROUT     =	$FFD2
    564  08a9 ????
    565  0801					      ORG	BASIC_RAM
    566  0801
    567  0801
    568  0801
    569  0801
    570  0801
    571  0801
    572  0801
    573  0801
    574  0801
    575  0801		       0d 08 e4 07*BASIC_ROW_0 BYTE.b	[BASIC_ROW_1%256],[BASIC_ROW_1/256],[2020%256],[2020/256],158,32,[[[MAIN%100000]-[MAIN%10000]]/10000+$30],[[[MAIN%10000]-[MAIN%1000]]/1000+$30],[[[MAIN%1000]-[MAIN%100]]/100+$30],[[[MAIN%100]-[MAIN%10]]/10+$30],[[[MAIN%10]-[MAIN%1]]/1+$30],0
    576  080d		       00 00	   BASIC_ROW_1 BYTE.b	0,0
    577  080f
    578  080f				   MAIN
    579  080f		       a9 00		      LDA	#0
    580  0811		       8d 20 d0 	      STA	53280
    581  0814
    582  0814		       a9 00		      LDA	#0
    583  0816		       8d 21 d0 	      STA	53281
    584  0819
    585  0819		       a9 0f		      LDA	#15
    586  081b		       8d 18 d4 	      STA	54296
    587  081e
    588  081e		       a9 0e		      LDA	#14
    589  0820		       20 d2 ff 	      JSR	CHROUT
    590  0823		       a9 93		      LDA	#147
    591  0825		       20 d2 ff 	      JSR	CHROUT
    592  0828		       a9 05		      LDA	#5
    593  082a		       20 d2 ff 	      JSR	CHROUT
    594  082d
    595  082d				   TERMINAL
    596  082d
    597  082d		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    598  0830				   IF_591_START
    599  0830		       c9 00		      CMP	#0
    600  0832		       f0 2a		      BEQ	IF_591_ELSE
    601  0834		       20 79 08 	      JSR	CURSOR_OFF
    602  0837				   DO_593_START
    603  0837
    604  0837		       a2 00		      LDX	#0
    605  0839		       86 d4		      STX	$D4
    606  083b		       86 d8		      STX	$D8
    607  083d
    608  083d
    609  083d		       ad f0 d7 	      LDA	MODEM_DATA_IN
    610  0840
    611  0840
    612  0840		       48		      PHA
    613  0841				   IF_604_START
    614  0841		       c9 07		      CMP	#7
    615  0843		       d0 03		      BNE	IF_604_ELSE
    616  0845		       20 8a 08 	      JSR	TERM_BELL
    617  0848				   IF_604_ELSE
    618  0848				   IF_604_END
    619  0848
    620  0848		       68		      PLA
    621  0849
    622  0849
    623  0849		       20 d2 ff 	      JSR	CHROUT
    624  084c
    625  084c
    626  084c		       a9 00		      LDA	#0
    627  084e		       8d f1 d7 	      STA	MODEM_ACK
    628  0851		       a9 01		      LDA	#1
    629  0853		       8d f1 d7 	      STA	MODEM_ACK
    630  0856
    631  0856
    632  0856		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    633  0859		       d0 dc		      BNE	DO_593_START
    634  085b				   DO_593_END
    635  085b
    636  085b		       20 74 08 	      JSR	CURSOR_ON
    637  085e				   IF_591_ELSE
    638  085e				   IF_591_END
    639  085e
    640  085e
    641  085e		       20 e4 ff 	      JSR	GETIN
    642  0861				   IF_629_START
    643  0861		       c9 00		      CMP	#0
    644  0863		       f0 03		      BEQ	IF_629_ELSE
    645  0865		       8d f2 d7 	      STA	MODEM_DATA_OUT
    646  0868				   IF_629_ELSE
    647  0868				   IF_629_END
    648  0868
    649  0868
    650  0868
    651  0868		       ad f4 d7 	      LDA	MODEM_CONNST
    652  086b		       8d 20 d0 	      STA	53280
    653  086e		       8d 21 d0 	      STA	53281
    654  0871
    655  0871		       4c 2d 08 	      JMP	TERMINAL
    656  0874
    657  0874
    658  0874
    659  0874
    660  0874				   CURSOR_ON
    661  0874		       a0 00		      LDY	#$00
    662  0876		       84 cc		      STY	$CC
    663  0878		       60		      RTS
    664  0879
    665  0879				   CURSOR_OFF
    666  0879		       a4 cc		      LDY	$CC
    667  087b				   IF_651_START
    668  087b		       d0 08		      BNE	IF_651_ELSE
    669  087d		       a0 01		      LDY	#$01
    670  087f		       84 cd		      STY	$CD
    671  0881				   DO_646_START
    672  0881		       a4 cf		      LDY	$CF
    673  0883		       d0 fc		      BNE	DO_646_START
    674  0885				   DO_646_END
    675  0885
    676  0885				   IF_651_ELSE
    677  0885				   IF_651_END
    678  0885		       a0 ff		      LDY	#$FF
    679  0887		       84 cc		      STY	$CC
    680  0889		       60		      RTS
    681  088a
    682  088a				   TERM_BELL
    683  088a		       a9 0f		      LDA	#15
    684  088c		       8d 18 d4 	      STA	$D418
    685  088f
    686  088f		       a9 14		      LDA	#20
    687  0891		       8d 01 d4 	      STA	$D401
    688  0894
    689  0894		       a9 00		      LDA	#0
    690  0896		       8d 05 d4 	      STA	$D405
    691  0899
    692  0899		       a9 f9		      LDA	#249
    693  089b		       8d 06 d4 	      STA	$D406
    694  089e
    695  089e		       a9 11		      LDA	#17
    696  08a0		       8d 04 d4 	      STA	$D404
    697  08a3
    698  08a3		       a9 10		      LDA	#16
    699  08a5		       8d 04 d4 	      STA	$D404
    700  08a8
    701  08a8		       60		      RTS
    702  08a9
