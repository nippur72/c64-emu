------- FILE terminal.asm LEVEL 1 PASS 2
      1  08c4		       d7 f2	   MODEM_DATA_OUT EQU	$D7F2
      2  08c4		       d7 f0	   MODEM_DATA_IN EQU	$D7F0
      3  08c4		       d7 f3	   MODEM_DATA_REQ EQU	$D7F3
      4  08c4		       d7 f1	   MODEM_ACK  EQU	$D7F1	; PORTA PER L'HANDSHAKE
      5  08c4		       d7 f4	   MODEM_CONNST EQU	$D7F4
      6  08c4 ????
      7  08c4 ????				      PROCESSOR	6502
      8  08c4 ????
      9  08c4 ????
     10  08c4 ????
     11  08c4 ????
     12  08c4 ????
     13  08c4 ????
     14  08c4 ????
     15  08c4 ????
     16  08c4 ????
     17  08c4 ????
     18  08c4 ????
     19  08c4 ????
     20  08c4 ????
     21  08c4 ????
     22  08c4 ????
     23  08c4 ????
     24  08c4 ????
     25  08c4 ????
     26  08c4 ????
     27  08c4 ????
     28  08c4 ????
     29  08c4 ????
     30  08c4 ????
     31  08c4 ????
     32  08c4 ????
     33  08c4 ????
     34  08c4 ????
     35  08c4 ????
     36  08c4 ????
     37  08c4 ????
     38  08c4 ????
     39  08c4 ????
     40  08c4 ????
     41  08c4 ????
     42  08c4 ????
     43  08c4 ????
     44  08c4 ????
     45  08c4 ????
     46  08c4 ????
     47  08c4 ????
     48  08c4 ????
     49  08c4 ????
     50  08c4 ????
     51  08c4 ????
     52  08c4 ????
     53  08c4 ????
     54  08c4 ????
     55  08c4 ????
     56  08c4 ????
     57  08c4 ????
     58  08c4 ????
     59  08c4 ????
     60  08c4 ????
     61  08c4 ????
     62  08c4 ????
     63  08c4 ????
     64  08c4 ????
     65  08c4 ????
     66  08c4 ????
     67  08c4 ????
     68  08c4 ????
     69  08c4 ????
     70  08c4 ????
     71  08c4 ????
     72  08c4 ????
     73  08c4 ????
     74  08c4 ????
     75  08c4 ????
     76  08c4 ????
     77  08c4 ????
     78  08c4 ????
     79  08c4 ????
     80  08c4 ????
     81  08c4 ????
     82  08c4 ????
     83  08c4 ????
     84  08c4 ????
     85  08c4 ????
     86  08c4 ????
     87  08c4 ????
     88  08c4 ????
     89  08c4 ????
     90  08c4 ????
     91  08c4 ????
     92  08c4 ????
     93  08c4 ????
     94  08c4 ????
     95  08c4 ????
     96  08c4 ????
     97  08c4 ????
     98  08c4 ????
     99  08c4 ????
    100  08c4 ????
    101  08c4 ????
    102  08c4 ????
    103  08c4 ????
    104  08c4 ????
    105  08c4 ????
    106  08c4 ????
    107  08c4 ????
    108  08c4 ????
    109  08c4 ????
    110  08c4 ????
    111  08c4 ????
    112  08c4 ????
    113  08c4 ????
    114  08c4 ????
    115  08c4 ????
    116  08c4 ????
    117  08c4 ????
    118  08c4 ????
    119  08c4 ????
    120  08c4 ????
    121  08c4 ????
    122  08c4 ????
    123  08c4 ????
    124  08c4 ????
    125  08c4 ????
    126  08c4 ????
    127  08c4 ????
    128  08c4 ????
    129  08c4 ????
    130  08c4 ????
    131  08c4 ????
    132  08c4 ????
    133  08c4 ????
    134  08c4 ????
    135  08c4 ????
    136  08c4 ????
    137  08c4 ????
    138  08c4 ????
    139  08c4 ????
    140  08c4 ????
    141  08c4 ????
    142  08c4 ????
    143  08c4 ????
    144  08c4 ????
    145  08c4 ????
    146  08c4 ????
    147  08c4 ????
    148  08c4 ????
    149  08c4 ????
    150  08c4 ????
    151  08c4 ????
    152  08c4 ????
    153  08c4 ????
    154  08c4 ????
    155  08c4 ????
    156  08c4 ????
    157  08c4 ????
    158  08c4 ????
    159  08c4 ????
    160  08c4 ????
    161  08c4 ????
    162  08c4 ????
    163  08c4 ????
    164  08c4 ????
    165  08c4 ????
    166  08c4 ????
    167  08c4 ????
    168  08c4 ????
    169  08c4 ????
    170  08c4 ????
    171  08c4 ????
    172  08c4 ????
    173  08c4 ????
    174  08c4 ????
    175  08c4 ????
    176  08c4 ????
    177  08c4 ????
    178  08c4 ????
    179  08c4 ????
    180  08c4 ????
    181  08c4 ????
    182  08c4 ????
    183  08c4 ????
    184  08c4 ????
    185  08c4 ????
    186  08c4 ????
    187  08c4 ????
    188  08c4 ????
    189  08c4 ????
    190  08c4 ????
    191  08c4 ????
    192  08c4 ????
    193  08c4 ????
    194  08c4 ????
    195  08c4 ????
    196  08c4 ????
    197  08c4 ????
    198  08c4 ????
    199  08c4 ????
    200  08c4 ????
    201  08c4 ????
    202  08c4 ????
    203  08c4 ????
    204  08c4 ????
    205  08c4 ????
    206  08c4 ????
    207  08c4 ????
    208  08c4 ????
    209  08c4 ????
    210  08c4 ????
    211  08c4 ????
    212  08c4 ????
    213  08c4 ????
    214  08c4 ????
    215  08c4 ????
    216  08c4 ????
    217  08c4 ????
    218  08c4 ????
    219  08c4 ????
    220  08c4 ????
    221  08c4 ????
    222  08c4 ????
    223  08c4 ????
    224  08c4 ????
    225  08c4 ????
    226  08c4 ????
    227  08c4 ????
    228  08c4 ????
    229  08c4 ????
    230  08c4 ????
    231  08c4 ????
    232  08c4 ????
    233  08c4 ????
    234  08c4 ????
    235  08c4 ????
    236  08c4 ????
    237  08c4 ????
    238  08c4 ????
    239  08c4 ????
    240  08c4 ????
    241  08c4 ????
    242  08c4 ????
    243  08c4 ????
    244  08c4 ????
    245  08c4 ????
    246  08c4 ????
    247  08c4 ????
    248  08c4 ????
    249  08c4 ????
    250  08c4 ????
    251  08c4 ????
    252  08c4 ????
    253  08c4 ????
    254  08c4 ????
    255  08c4 ????
    256  08c4 ????
    257  08c4 ????
    258  08c4 ????
    259  08c4 ????
    260  08c4 ????
    261  08c4 ????
    262  08c4 ????
    263  08c4 ????
    264  08c4 ????
    265  08c4 ????
    266  08c4 ????
    267  08c4 ????
    268  08c4 ????
    269  08c4 ????
    270  08c4 ????
    271  08c4 ????
    272  08c4 ????
    273  08c4 ????
    274  08c4 ????
    275  08c4 ????
    276  08c4 ????
    277  08c4 ????
    278  08c4 ????
    279  08c4 ????
    280  08c4 ????
    281  08c4 ????
    282  08c4 ????
    283  08c4 ????
    284  08c4 ????
    285  08c4 ????
    286  08c4 ????
    287  08c4 ????
    288  08c4 ????
    289  08c4 ????
    290  08c4 ????
    291  08c4 ????
    292  08c4 ????
    293  08c4 ????
    294  08c4 ????
    295  08c4 ????
    296  08c4 ????
    297  08c4 ????
    298  08c4 ????
    299  08c4 ????
    300  08c4 ????
    301  08c4 ????
    302  08c4 ????
    303  08c4 ????
    304  08c4 ????
    305  08c4 ????
    306  08c4 ????
    307  08c4 ????
    308  08c4 ????
    309  08c4 ????
    310  08c4 ????
    311  08c4 ????
    312  08c4 ????
    313  08c4 ????
    314  08c4 ????
    315  08c4 ????
    316  08c4 ????
    317  08c4 ????
    318  08c4 ????
    319  08c4 ????
    320  08c4 ????
    321  08c4 ????
    322  08c4 ????
    323  08c4 ????
    324  08c4 ????
    325  08c4 ????
    326  08c4 ????
    327  08c4 ????
    328  08c4 ????
    329  08c4 ????
    330  08c4 ????
    331  08c4 ????
    332  08c4 ????
    333  08c4 ????
    334  08c4 ????
    335  08c4 ????
    336  08c4 ????
    337  08c4 ????
    338  08c4 ????
    339  08c4 ????
    340  08c4 ????
    341  08c4 ????
    342  08c4 ????
    343  08c4 ????
    344  08c4 ????
    345  08c4 ????
    346  08c4 ????
    347  08c4 ????
    348  08c4 ????
    349  08c4 ????
    350  08c4 ????
    351  08c4 ????
    352  08c4 ????
    353  08c4 ????
    354  08c4 ????
    355  08c4 ????
    356  08c4 ????
    357  08c4 ????
    358  08c4 ????
    359  08c4 ????
    360  08c4 ????
    361  08c4 ????
    362  08c4 ????
    363  08c4 ????
    364  08c4 ????
    365  08c4 ????
    366  08c4 ????
    367  08c4 ????
    368  08c4 ????
    369  08c4 ????
    370  08c4 ????
    371  08c4 ????
    372  08c4 ????
    373  08c4 ????
    374  08c4 ????
    375  08c4 ????
    376  08c4 ????
    377  08c4 ????
    378  08c4 ????
    379  08c4 ????
    380  08c4 ????
    381  08c4 ????
    382  08c4 ????
    383  08c4 ????
    384  08c4 ????
    385  08c4 ????
    386  08c4 ????
    387  08c4 ????
    388  08c4 ????
    389  08c4 ????
    390  08c4 ????
    391  08c4 ????
    392  08c4 ????
    393  08c4 ????
    394  08c4 ????
    395  08c4 ????
    396  08c4 ????
    397  08c4 ????
    398  08c4 ????
    399  08c4 ????
    400  08c4 ????
    401  08c4 ????
    402  08c4 ????
    403  08c4 ????
    404  08c4 ????
    405  08c4 ????
    406  08c4 ????
    407  08c4 ????
    408  08c4 ????
    409  08c4 ????
    410  08c4 ????
    411  08c4 ????
    412  08c4 ????
    413  08c4 ????
    414  08c4 ????
    415  08c4 ????
    416  08c4 ????
    417  08c4 ????
    418  08c4 ????
    419  08c4 ????
    420  08c4 ????
    421  08c4 ????
    422  08c4 ????
    423  08c4 ????
    424  08c4 ????
    425  08c4 ????
    426  08c4 ????
    427  08c4 ????
    428  08c4 ????
    429  08c4 ????
    430  08c4 ????
    431  08c4 ????
    432  08c4 ????
    433  08c4 ????
    434  08c4 ????
    435  08c4 ????
    436  08c4 ????
    437  08c4 ????
    438  08c4 ????
    439  08c4 ????
    440  08c4 ????
    441  08c4 ????
    442  08c4 ????
    443  08c4 ????
    444  08c4 ????
    445  08c4 ????
    446  08c4 ????
    447  08c4 ????
    448  08c4 ????
    449  08c4 ????
    450  08c4 ????
    451  08c4 ????
    452  08c4 ????
    453  08c4 ????
    454  08c4 ????
    455  08c4 ????
    456  08c4 ????
    457  08c4 ????
    458  08c4 ????
    459  08c4 ????
    460  08c4 ????
    461  08c4 ????
    462  08c4 ????	       ff e4	   GETIN      =	$FFE4
    463  08c4 ????	       e5 44	   CLRSCN     =	$E544
    464  08c4 ????	       ab 1e	   PRNSTR     =	$AB1E
    465  08c4 ????	       e5 66	   GOHOME     =	$E566
    466  08c4 ????	       bd cd	   PRNINT     =	$BDCD
    467  08c4 ????
    468  08c4 ????
    469  08c4 ????
    470  08c4 ????	       00 d1	   CURSOR_PTR =	209
    471  08c4 ????	       00 a2	   JIFFY_CLOCK =	162
    472  08c4 ????	       02 86	   CRSRCOL    =	646
    473  08c4 ????	       00 01	   MEMORY_CONFIG =	1
    474  08c4 ????
    475  08c4 ????
    476  08c4 ????
    477  08c4 ????	       00 00	   COLOR_BLACK =	0
    478  08c4 ????	       00 01	   COLOR_WHITE =	1
    479  08c4 ????	       00 02	   COLOR_RED  =	2
    480  08c4 ????	       00 03	   COLOR_CYAN =	3
    481  08c4 ????	       00 04	   COLOR_MAGENTA =	4
    482  08c4 ????	       00 05	   COLOR_GREEN =	5
    483  08c4 ????	       00 06	   COLOR_BLUE =	6
    484  08c4 ????	       00 07	   COLOR_YELLOW =	7
    485  08c4 ????
    486  08c4 ????
    487  08c4 ????
    488  08c4 ????
    489  08c4 ????	       00 28	   SCREEN_COLS =	40
    490  08c4 ????	       00 19	   SCREEN_ROWS =	25
    491  08c4 ????	       04 00	   VIDEO_RAM  =	1024
    492  08c4 ????	       d8 00	   COLOR_RAM  =	55296
    493  08c4 ????	       00 d4	   COLOR_PAGE_OFFSET =	((COLOR_RAM - VIDEO_RAM) / 256)
    494  08c4 ????	       08 01	   BASIC_RAM  =	2049
    495  08c4 ????	       d0 12	   RASTER     =	$D012
    496  08c4 ????	       d0 00	   ROMCHAR    =	$D000
    497  08c4 ????	       d0 20	   BORDER     =	53280
    498  08c4 ????	       d0 21	   BACKGROUND =	53281
    499  08c4 ????
    500  08c4 ????
    501  08c4 ????
    502  08c4 ????
    503  08c4 ????
    504  08c4 ????
    505  08c4 ????
    506  08c4 ????
    507  08c4 ????
    508  08c4 ????
    509  08c4 ????
    510  08c4 ????
    511  08c4 ????
    512  08c4 ????
    513  08c4 ????
    514  08c4 ????
    515  08c4 ????
    516  08c4 ????
    517  08c4 ????
    518  08c4 ????
    519  08c4 ????
    520  08c4 ????
    521  08c4 ????
    522  08c4 ????
    523  08c4 ????
    524  08c4 ????
    525  08c4 ????
    526  08c4 ????
    527  08c4 ????
    528  08c4 ????
    529  08c4 ????
    530  08c4 ????
    531  08c4 ????
    532  08c4 ????
    533  08c4 ????
    534  08c4 ????
    535  08c4 ????
    536  08c4 ????
    537  08c4 ????
    538  08c4 ????
    539  08c4 ????
    540  08c4 ????
    541  08c4 ????
    542  08c4 ????
    543  08c4 ????
    544  08c4 ????
    545  08c4 ????
    546  08c4 ????
    547  08c4 ????
    548  08c4 ????
    549  08c4 ????
    550  08c4 ????
    551  08c4 ????
    552  08c4 ????
    553  08c4 ????
    554  08c4 ????
    555  08c4 ????
    556  08c4 ????
    557  08c4 ????
    558  08c4 ????
    559  08c4 ????
    560  08c4 ????
    561  08c4 ????
    562  08c4 ????	       ff e4	   GETIN      =	$FFE4
    563  08c4 ????	       ff d2	   CHROUT     =	$FFD2
    564  08c4 ????
    565  0801					      ORG	BASIC_RAM
    566  0801
    567  0801
    568  0801
    569  0801
    570  0801
    571  0801
    572  0801
    573  0801
    574  0801
    575  0801		       19 08 0a 00*BASIC_ROW_0 BYTE.b	[BASIC_ROW_1%256],[BASIC_ROW_1/256],[10%256],[10/256],151,32,53,51,50,56,48,44,48,58,151,32,53,51,50,56,49,44,48,0
    576  0819		       28 08 14 00*BASIC_ROW_1 BYTE.b	[BASIC_ROW_2%256],[BASIC_ROW_2/256],[20%256],[20/256],151,32,53,52,50,57,54,44,49,53,0
    577  0828		       3a 08 1e 00*BASIC_ROW_2 BYTE.b	[BASIC_ROW_3%256],[BASIC_ROW_3/256],[30%256],[30/256],153,32,199,40,49,52,41,170,34,5,147,34,59,0
    578  083a		       46 08 28 00*BASIC_ROW_3 BYTE.b	[BASIC_ROW_4%256],[BASIC_ROW_4/256],[40%256],[40/256],158,32,[[[TERMINAL%100000]-[TERMINAL%10000]]/10000+$30],[[[TERMINAL%10000]-[TERMINAL%1000]]/1000+$30],[[[TERMINAL%1000]-[TERMINAL%100]]/100+$30],[[[TERMINAL%100]-[TERMINAL%10]]/10+$30],[[[TERMINAL%10]-[TERMINAL%1]]/1+$30],0
    579  0846		       00 00	   BASIC_ROW_4 BYTE.b	0,0
    580  0848
    581  0848				   TERMINAL
    582  0848
    583  0848		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    584  084b				   IF_577_START
    585  084b		       c9 00		      CMP	#0
    586  084d		       f0 2a		      BEQ	IF_577_ELSE
    587  084f		       20 94 08 	      JSR	CURSOR_OFF
    588  0852				   DO_579_START
    589  0852
    590  0852		       a2 00		      LDX	#0
    591  0854		       86 d4		      STX	$D4
    592  0856		       86 d8		      STX	$D8
    593  0858
    594  0858
    595  0858		       ad f0 d7 	      LDA	MODEM_DATA_IN
    596  085b
    597  085b
    598  085b		       48		      PHA
    599  085c				   IF_590_START
    600  085c		       c9 07		      CMP	#7
    601  085e		       d0 03		      BNE	IF_590_ELSE
    602  0860		       20 a5 08 	      JSR	TERM_BELL
    603  0863				   IF_590_ELSE
    604  0863				   IF_590_END
    605  0863
    606  0863		       68		      PLA
    607  0864
    608  0864
    609  0864		       20 d2 ff 	      JSR	CHROUT
    610  0867
    611  0867
    612  0867		       a9 00		      LDA	#0
    613  0869		       8d f1 d7 	      STA	MODEM_ACK
    614  086c		       a9 01		      LDA	#1
    615  086e		       8d f1 d7 	      STA	MODEM_ACK
    616  0871
    617  0871
    618  0871		       ad f3 d7 	      LDA	MODEM_DATA_REQ
    619  0874		       d0 dc		      BNE	DO_579_START
    620  0876				   DO_579_END
    621  0876
    622  0876		       20 8f 08 	      JSR	CURSOR_ON
    623  0879				   IF_577_ELSE
    624  0879				   IF_577_END
    625  0879
    626  0879
    627  0879		       20 e4 ff 	      JSR	GETIN
    628  087c				   IF_615_START
    629  087c		       c9 00		      CMP	#0
    630  087e		       f0 03		      BEQ	IF_615_ELSE
    631  0880		       8d f2 d7 	      STA	MODEM_DATA_OUT
    632  0883				   IF_615_ELSE
    633  0883				   IF_615_END
    634  0883
    635  0883
    636  0883
    637  0883		       ad f4 d7 	      LDA	MODEM_CONNST
    638  0886		       8d 20 d0 	      STA	53280
    639  0889		       8d 21 d0 	      STA	53281
    640  088c
    641  088c		       4c 48 08 	      JMP	TERMINAL
    642  088f
    643  088f
    644  088f
    645  088f
    646  088f				   CURSOR_ON
    647  088f		       a0 00		      LDY	#$00
    648  0891		       84 cc		      STY	$CC
    649  0893		       60		      RTS
    650  0894
    651  0894				   CURSOR_OFF
    652  0894		       a4 cc		      LDY	$CC
    653  0896				   IF_637_START
    654  0896		       d0 08		      BNE	IF_637_ELSE
    655  0898		       a0 01		      LDY	#$01
    656  089a		       84 cd		      STY	$CD
    657  089c				   DO_632_START
    658  089c		       a4 cf		      LDY	$CF
    659  089e		       d0 fc		      BNE	DO_632_START
    660  08a0				   DO_632_END
    661  08a0
    662  08a0				   IF_637_ELSE
    663  08a0				   IF_637_END
    664  08a0		       a0 ff		      LDY	#$FF
    665  08a2		       84 cc		      STY	$CC
    666  08a4		       60		      RTS
    667  08a5
    668  08a5				   TERM_BELL
    669  08a5		       a9 0f		      LDA	#15
    670  08a7		       8d 18 d4 	      STA	$D418
    671  08aa
    672  08aa		       a9 14		      LDA	#20
    673  08ac		       8d 01 d4 	      STA	$D401
    674  08af
    675  08af		       a9 00		      LDA	#0
    676  08b1		       8d 05 d4 	      STA	$D405
    677  08b4
    678  08b4		       a9 f9		      LDA	#249
    679  08b6		       8d 06 d4 	      STA	$D406
    680  08b9
    681  08b9		       a9 11		      LDA	#17
    682  08bb		       8d 04 d4 	      STA	$D404
    683  08be
    684  08be		       a9 10		      LDA	#16
    685  08c0		       8d 04 d4 	      STA	$D404
    686  08c3
    687  08c3		       60		      RTS
    688  08c4
